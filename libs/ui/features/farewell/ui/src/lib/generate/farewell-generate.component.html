<div class="flex flex-col justify-center items-center gap-10">
  <span class="text-2xl">Farewell üóíÔ∏è ü´Ç</span>

  <form class="w-full" [formGroup]="farewellFormGroup">
    <p-floatLabel class="block">
      <input
        class="w-full"
        id="title"
        type="text"
        pInputText
        formControlName="titleControl" />
      <label for="title">Title</label>
    </p-floatLabel>
    <section class="mb-2">
      @if(!farewellFormGroup.get('titleControl')?.value?.length ||
      farewellFormGroup.get('titleControl')?.errors?.['minlength']) {
      <strong class="block text-xs text-gray-400">
        Must be at least 2 characters long. Currently you got
        {{ farewellFormGroup.get('titleControl')?.value?.length }}.
      </strong>
      } @if(farewellFormGroup.get('titleControl')?.errors?.['maxlength']) {
      <strong class="block text-xs text-gray-400">
        Must be less than 128 characters long. Currently you got
        {{ farewellFormGroup.get('titleControl')?.value?.length }}.
      </strong>
      }
    </section>

    <p-editor
      id="farewell-float"
      placeholder="Add farewell to your (ex-) colleagues üî•"
      [modules]="modules"
      [style]="{ height: '320px' }"
      class="w-full"
      (onTextChange)="onTextChangeHandler($event)"
      formControlName="editorControl">
      <p-header></p-header>
    </p-editor>

    @if(editorTextValue().length < 64) {
    <strong class="block text-xs text-gray-400">
      Must be at least 64 characters long. Current length is
      {{ editorTextValue().length }} characters.
    </strong>
    } @if(editorTextValue().length > 8192) {
    <strong class="block text-xs text-gray-400">
      Must be less than 8192 characters long. Current length is
      {{ editorTextValue().length }} characters.
    </strong>
    }
  </form>

  <section class="w-full">
    <h3 class="font-semibold">Media</h3>
    <div
      class="ml-4 flex items-center justify-start"
      id="uploaded-media-gallery">
      @for (media of farewellMedias(); track $index) {
      <div class="relative">
        <a
          class="relative block w-24 h-24 mb-3"
          [href]="media.url"
          data-pswp-width="150"
          data-pswp-height="150"
          target="_blank">
          <img
            referrerpolicy="no-referrer"
            class="rounded-full w-full h-full"
            width="64"
            height="64"
            [ngSrc]="media.url"
            alt="Farewell media" />
        </a>
        <ui-kit-delete
          yOffset="-top-1"
          xOffset="-right-3"
          (onDelete)="deleteFarewellMediaHandler(media)" />
      </div>

      }
    </div>

    <h3 class="mt-2 font-semibold">New</h3>
    <div class="ml-4 flex items-center justify-start gap-8">
      <ui-kit-comp-animate-ping [newlyAddedItem]="true">
        <ui-kit-pic-uploadable
          [imgConf]="{ src: '/farewell/farewell-page-logo-small.jpeg' }"
          [fileUploadConf]="{ multiple: true }"
          [autoUploadCb]="onBasicUploadAuto.bind(this)"></ui-kit-pic-uploadable>
      </ui-kit-comp-animate-ping>

      <div
        class="ml-4 flex gap-2 items-center justify-start"
        id="new-media-gallery">
        @for (file of filesToUpload(); track $index) {
        <div class="relative">
          <a
            class="relative block w-16 h-16"
            [href]="
              domSanitizer.bypassSecurityTrustUrl(URL.createObjectURL(file))
            "
            data-pswp-width="150"
            data-pswp-height="150"
            target="_blank">
            <img
              referrerpolicy="no-referrer"
              class="rounded-full w-full h-full"
              width="64"
              height="64"
              [src]="
                domSanitizer.bypassSecurityTrustUrl(URL.createObjectURL(file))
              "
              alt="Farewell media" />
          </a>
          <ui-kit-delete
            yOffset="-top-1"
            xOffset="-right-3"
            (onDelete)="deleteNewMediaHandler(file)" />
        </div>
        }
      </div>
    </div>
  </section>

  <p-button
    [disabled]="
      !(
        farewellFormGroup.valid &&
        editorTextValue().length >= 64 &&
        editorTextValue().length <= 8192
      )
    "
    (onClick)="saveFarewellHandler()"
    label="Save farewell"
    [raised]="true" />
</div>
