<form class="flex flex-col" [formGroup]="kudoBoardFormGroup">
  <div>
    @let isMobile = (deviceService.isMobile$ | async); @let background =
    kudoBoardFormGroup.get('background')?.value;

    <div class="flex flex-col md:flex-row gap-2 justify-center items-center">
      <div
        sharedUserHint
        text="Add image"
        [side]="isMobile ? 'right' : 'left'"
        [extraIdent]="isMobile ? { top: 5, right: 25 } : { top: 30, left: 65 }">
        <ui-kit-pic-uploadable [autoUploadCb]="autoUploadBackground.bind(this)">
          @if((background?.length ?? 0) > 24 && isBucketUrl(background)) {
          <ng-template uiKitPicUploadableTemplate>
            <img class="w-full object-cover max-h-[33vh]" [src]="background" />
          </ng-template>
          }
        </ui-kit-pic-uploadable>
      </div>

      <p class="text-xl font-bold italic">OR</p>

      <div
        class="block min-w-[64px] min-h-[64px]"
        [ngClass]="isHexColor(background) ? 'h-32 w-1/3' : ''"
        sharedUserHint
        text="... pick a color"
        side="right"
        [extraIdent]="{ top: 10, right: 35 }">
        <ui-kit-color-picker
          [currentColor]="isHexColor(background) ? background : undefined"
          (colorAccepted)="updateBackgroundColor($event)" />
        @if(isHexColor(background)) {
        <ui-kit-color-displayer
          class="absolute left-0 top-0 w-full h-full rounded"
          [color]="background" />
        }
      </div>
    </div>

    <p-floatLabel class="block mt-20">
      <input
        class="w-full border-none shadow-none text-4xl focus:outline-none"
        id="title"
        type="text"
        pInputText
        formControlName="title" />
      <label class="w-full text-4xl" for="title">Kudo Board Title</label>
    </p-floatLabel>

    <section class="relative">
      <strong
        uiKitSmallTextTailwindClasses
        class="absolute right-6 bottom-6 text-xs">
        {{ kudoBoardFormGroup.get('title')?.value?.length }} /
        {{ titleMaxLength }}
      </strong>
    </section>
  </div>

  <p-floatLabel class="block mt-4">
    <input
      class="w-full border-none shadow-none text-4xl focus:outline-none"
      id="title"
      type="text"
      pInputText
      formControlName="recipient" />
    <label class="w-full text-4xl" for="title">Kudo Board Recipient</label>
  </p-floatLabel>

  <ng-template #statusTmpl>
    @let status = kudoBoardFormGroup.get('status')?.value;
    <p-button
      (onClick)="updateStatus(status)"
      [label]="
        status === kudoBoardStatus.Published ? 'Back to draft' : 'Publish'
      "
      [rounded]="true"
      [severity]="
        status === kudoBoardStatus.Published ? 'secondary' : 'success'
      " />
  </ng-template>
  <div class="text-center">
    <ng-container *ngTemplateOutlet="statusTmpl"></ng-container>
  </div>
</form>
